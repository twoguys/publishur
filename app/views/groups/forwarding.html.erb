<div class="border-bottom">
	<h2><%= @group.name %></h2>
	<%= link_to('Back to the group page', @group) %>
</div>

<div class="centered">
	<h2>How would you like to receive messages from this group?</h2>
	<div class="mt10">
		You can have messages posted in this group sent to you via email, chat, phone, and more!<br/>
		<strong>This information is kept private, so others cannot see it</strong>.
	</div>
</div>

<div class="w600">
	<div class="shadowed-box">
		<h2 class="strong border-bottom mt10">You're currently receiving messages from this group via...</h2>
		<% form_for @group do |form| %>
			<ul id="subscriptions" class="subscriptions mb10">
				<li>
					<span class="strong contact-type">Type</span>
					<span class="strong contact-info">Contact Info</span>
				</li>
				<% form.fields_for :subscriptions do |sf| %>
					<% if sf.object.user == current_user %>
					<li class="subscription">
						<span class="contact-type">
							<%= sf.hidden_field :user_id, :value => current_user.id %>
							<%= sf.select(:contact_type, Subscription.types.collect {|t| [ t, t ] }) %>
						</span>
						<span>
							<%= sf.text_field :contact_info %>
						</span>
						<span>
							<%= sf.hidden_field(:_delete, :value => '0', :class => 'delete-hidden') %>
							<%= link_to(image_tag('/images/icons/delete.png', :title => 'Delete this subscription'), '#', :class => 'delete-subscription')%>
						</span>
					</li>
					<% end %>
				<% end %>
			</ul>
			<div class="mb10"><%= link_to('Add another forwarding rule', '#', :id => 'add-subscription') %></div>
			<div id="save-warning" class="h30"></div>
			<%= form.submit "Save" %> or <%= link_to('Cancel', @group) %>
		<% end %>
	</div>
</div>	

<script type="text/javascript">
	function linkDeleteClicks() {
		$('.delete-subscription').click(function() {
			var hidden = $(this).prev('.delete-hidden');
			if (hidden) {
				hidden.val('1');
				$(this).parents('.subscription').hide();
			} else {
				$(this).parents('.subscription').remove();
			}
			//$('#save-warning').text("Make sure you save, since you've deleted something").
		});
	}
	$(document).ready(function() {
		$('#add-subscription').click(function() {
			var time = new Date().getTime();
			var html = '<li class="subscription"><span class="contact-type">' +
				'<input id="group_subscriptions_attributes_0_user_id" name="group[subscriptions_attributes][' + time +
				'][user_id]" type="hidden" value="1">' +
				'<%= select(:subscription,
					:contact_type,
					Subscription.types.collect {|t| [ t, t ] },
					{},
					:name => "group[subscriptions_attributes][' + time + '][contact_type]").gsub(/\n/, "") %></span>' +
				'<span><%= text_field_tag("temp", nil, :name => "group[subscriptions_attributes]['
				+ time + '][contact_info]") %></span>' +
				'<span><%= link_to(image_tag("/images/icons/delete.png", :title => "Delete this subscription"), "#", :class => "delete-subscription")%></span></li>';
			$('#subscriptions').append(html);
			linkDeleteClicks();
			return false;
		});
		
		linkDeleteClicks();
	});
</script>